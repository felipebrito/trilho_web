<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trilho Digital - Simples</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #333;
            color: white;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        .controls {
            width: 300px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            overflow-y: auto;
        }

        .viewport {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            /* For√ßar aspecto 16:9 horizontal */
            aspect-ratio: 16/9;
            max-height: 100vh;
            max-width: 100vw;
        }

        .image-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transform-origin: center center;
            border: 2px solid red; /* Debug: borda vermelha para ver o elemento */
            background-color: #333; /* Debug: cor de fundo para ver o elemento */
        }

        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        .section h3 {
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group input[type="number"] {
            width: 100%;
            padding: 5px;
            border: 1px solid #555;
            background: #222;
            color: white;
            border-radius: 4px;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }

        .value-display {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }

        .file-input {
            width: 100%;
            padding: 10px;
            border: 2px dashed #555;
            border-radius: 4px;
            background: #222;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="section">
                <h3>üìÅ Carregar Imagem</h3>
                <input type="file" id="imageFile" class="file-input" accept="image/*">
                <div class="value-display" id="imageStatus">Nenhuma imagem carregada</div>
            </div>

            <div class="section">
                <h3>üéØ Calibra√ß√£o</h3>
                
                <div class="control-group">
                    <label>Escala: <span id="scaleValue">1.0</span></label>
                    <input type="range" id="scaleSlider" min="0.1" max="3.0" step="0.001" value="1.0">
                    <input type="number" id="scaleInput" min="0.1" max="3.0" step="0.001" value="1.0">
                </div>

                <div class="control-group">
                    <label>Posi√ß√£o X: <span id="offsetXValue">0</span></label>
                    <input type="range" id="offsetXSlider" min="-5000" max="5000" step="1" value="0">
                    <input type="number" id="offsetXInput" min="-5000" max="5000" step="1" value="0">
                </div>

                <div class="control-group">
                    <label>Posi√ß√£o Y: <span id="offsetYValue">0</span></label>
                    <input type="range" id="offsetYSlider" min="-5000" max="5000" step="1" value="0">
                    <input type="number" id="offsetYInput" min="-5000" max="5000" step="1" value="0">
                </div>

                <button class="btn" onclick="resetCalibration()">Reset</button>
                <button class="btn" onclick="centerImage()">Centralizar</button>
            </div>

            <div class="section">
                <h3>üéÆ Controle Manual</h3>
                <div class="control-group">
                    <label>Posi√ß√£o: <span id="positionValue">0%</span></label>
                    <input type="range" id="positionSlider" min="0" max="200" step="0.1" value="0">
                    <input type="number" id="positionInput" min="0" max="200" step="0.1" value="0">
                </div>
            </div>

            <div class="section">
                <h3>üîß Presets</h3>
                <button class="btn btn-small" onclick="loadCalibrationImage()">Carregar Imagem de Calibra√ß√£o</button>
                <button class="btn btn-small" onclick="applyWorkingValues()">Aplicar Valores Funcionais</button>
            </div>
        </div>

        <div class="viewport">
            <div class="image-container">
                <div class="background-image" id="backgroundImage"></div>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplica√ß√£o
        let config = {
            imageUrl: '',
            scale: 1.0,
            offsetX: 0,
            offsetY: 0,
            position: 0
        };

        // Elementos DOM
        const backgroundImage = document.getElementById('backgroundImage');
        const imageFile = document.getElementById('imageFile');
        const imageStatus = document.getElementById('imageStatus');

        // Sliders e inputs
        const scaleSlider = document.getElementById('scaleSlider');
        const scaleInput = document.getElementById('scaleInput');
        const scaleValue = document.getElementById('scaleValue');

        const offsetXSlider = document.getElementById('offsetXSlider');
        const offsetXInput = document.getElementById('offsetXInput');
        const offsetXValue = document.getElementById('offsetXValue');

        const offsetYSlider = document.getElementById('offsetYSlider');
        const offsetYInput = document.getElementById('offsetYInput');
        const offsetYValue = document.getElementById('offsetYValue');

        const positionSlider = document.getElementById('positionSlider');
        const positionInput = document.getElementById('positionInput');
        const positionValue = document.getElementById('positionValue');

        // Inicializa√ß√£o
        function init() {
            console.log('üöÄ Inicializando aplica√ß√£o simples...');
            
            // Event listeners para carregamento de imagem
            imageFile.addEventListener('change', handleImageUpload);
            
            // Event listeners para calibra√ß√£o
            scaleSlider.addEventListener('input', () => updateScale(scaleSlider.value));
            scaleInput.addEventListener('input', () => updateScale(scaleInput.value));
            
            offsetXSlider.addEventListener('input', () => updateOffsetX(offsetXSlider.value));
            offsetXInput.addEventListener('input', () => updateOffsetX(offsetXInput.value));
            
            offsetYSlider.addEventListener('input', () => updateOffsetY(offsetYSlider.value));
            offsetYInput.addEventListener('input', () => updateOffsetY(offsetYInput.value));
            
            // Event listeners para posi√ß√£o
            positionSlider.addEventListener('input', () => updatePosition(positionSlider.value));
            positionInput.addEventListener('input', () => updatePosition(positionInput.value));
            
            console.log('‚úÖ Aplica√ß√£o inicializada!');
        }

        // Carregar imagem
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                config.imageUrl = e.target.result;
                backgroundImage.style.backgroundImage = `url(${config.imageUrl})`;
                imageStatus.textContent = `Imagem carregada: ${file.name}`;
                console.log('‚úÖ Imagem carregada:', file.name);
                applyTransform();
            };
            reader.readAsDataURL(file);
        }

        // Atualizar escala
        function updateScale(value) {
            config.scale = parseFloat(value);
            scaleSlider.value = config.scale;
            scaleInput.value = config.scale;
            scaleValue.textContent = config.scale.toFixed(3);
            applyTransform();
        }

        // Atualizar offset X
        function updateOffsetX(value) {
            config.offsetX = parseInt(value);
            offsetXSlider.value = config.offsetX;
            offsetXInput.value = config.offsetX;
            offsetXValue.textContent = config.offsetX;
            applyTransform();
        }

        // Atualizar offset Y
        function updateOffsetY(value) {
            config.offsetY = parseInt(value);
            offsetYSlider.value = config.offsetY;
            offsetYInput.value = config.offsetY;
            offsetYValue.textContent = config.offsetY;
            applyTransform();
        }

        // Atualizar posi√ß√£o
        function updatePosition(value) {
            config.position = parseFloat(value);
            positionSlider.value = config.position;
            positionInput.value = config.position;
            positionValue.textContent = config.position + '%';
            applyTransform();
        }

        // Aplicar transforma√ß√£o
        function applyTransform() {
            if (!config.imageUrl) return;

            // Calcular movimento horizontal baseado na posi√ß√£o
            const maxMovement = 2000; // Movimento m√°ximo em pixels
            const horizontalOffset = (config.position / 100) * maxMovement;
            
            const translateX = config.offsetX - horizontalOffset;
            const translateY = config.offsetY;
            
            const transform = `scale(${config.scale}) translate(${translateX}px, ${translateY}px)`;
            
            backgroundImage.style.transform = transform;
            
            console.log('üîÑ Transform aplicada:', {
                scale: config.scale,
                translateX: translateX,
                translateY: translateY,
                position: config.position
            });
        }

        // Fun√ß√µes de controle
        function resetCalibration() {
            config.scale = 1.0;
            config.offsetX = 0;
            config.offsetY = 0;
            config.position = 0;
            
            updateScale(1.0);
            updateOffsetX(0);
            updateOffsetY(0);
            updatePosition(0);
            
            console.log('üîÑ Calibra√ß√£o resetada');
        }

        function centerImage() {
            config.offsetX = 0;
            config.offsetY = 0;
            
            updateOffsetX(0);
            updateOffsetY(0);
            
            console.log('üéØ Imagem centralizada');
        }

        function loadCalibrationImage() {
            console.log('üîç Tentando carregar imagem de calibra√ß√£o...');
            
            // Primeiro, for√ßar uma cor de fundo para debug
            backgroundImage.style.backgroundColor = 'red';
            backgroundImage.style.border = '5px solid yellow';
            backgroundImage.style.minHeight = '200px';
            backgroundImage.style.minWidth = '200px';
            
            console.log('üîç Elemento background-image:', backgroundImage);
            console.log('üîç Estilos aplicados:', backgroundImage.style.cssText);
            
            // Primeiro, tentar carregar a imagem real
            const img = new Image();
            img.onload = function() {
                console.log('‚úÖ Imagem real carregada com sucesso!');
                config.imageUrl = 'editor/bg300x200-comtv.jpg';
                backgroundImage.style.backgroundImage = `url(${config.imageUrl})`;
                backgroundImage.style.backgroundColor = 'transparent';
                imageStatus.textContent = 'Imagem de calibra√ß√£o carregada';
                console.log('‚úÖ Imagem de calibra√ß√£o carregada');
                applyWorkingValues();
            };
            img.onerror = function() {
                console.log('‚ö†Ô∏è Imagem de calibra√ß√£o n√£o encontrada, usando placeholder colorido');
                // Usar placeholder colorido para debug
                config.imageUrl = 'https://via.placeholder.com/1920x1080/ff0000/ffffff?text=Calibra√ß√£o+300x200cm';
                backgroundImage.style.backgroundImage = `url(${config.imageUrl})`;
                backgroundImage.style.backgroundColor = 'blue'; // Cor de fundo para debug
                imageStatus.textContent = 'Placeholder de calibra√ß√£o carregado';
                applyWorkingValues();
            };
            img.src = 'editor/bg300x200-comtv.jpg';
        }

        function applyWorkingValues() {
            // Valores que funcionaram para 300x200cm
            config.scale = 0.542;
            config.offsetX = -2593;
            config.offsetY = -2272;
            config.position = 0;
            
            updateScale(0.542);
            updateOffsetX(-2593);
            updateOffsetY(-2272);
            updatePosition(0);
            
            console.log('‚úÖ Valores de calibra√ß√£o 300x200cm aplicados');
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
